<!DOCTYPE html>
<html>
<head>
    <title>{{ title }}</title>
</head>
<body>
    <h1>{{ title }}</h1>
    <button onclick="fetchData('/core')">Core Function</button>
    <button onclick="fetchData('/legacy')">Legacy Feature</button>
    <!-- <button onclick="fetchData('/new-feature')">New Feature</button> -->
    
    <h3 id="result">Result will appear here</h3>

    <script>
        function fetchData(endpoint) {
            fetch(endpoint)
                .then(response => {
                    if (!response.ok) return response.text().then(t => { throw new Error(t) });
                    return response.text();
                })
                .then(data => {
                    document.getElementById('result').innerText = data;
                    document.getElementById('result').style.color = "black";
                })
                .catch(err => {
                    document.getElementById('result').innerText = "Error: " + err.message;
                    document.getElementById('result').style.color = "red";
                });
        }

        let currentVersion = null;

        function checkVersion() {
            fetch('/version')
                .then(response => response.text())
                .then(version => {
                    if (currentVersion === null) {
                        currentVersion = version;
                    } else if (currentVersion !== version) {
                        console.log("New version detected! Reloading...");
                        window.location.reload(true);
                    }
                })
                .catch(err => console.log("Health check failed, maybe deploying..."));
        }

        setInterval(checkVersion, 2000);
    </script>
</body>
</html>